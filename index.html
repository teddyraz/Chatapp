<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>ğŸ”’ Private Chat</title>

<style>
body {
  font-family: Arial;
  max-width: 400px;
  margin: auto;
}
#chat {
  border: 1px solid #ccc;
  height: 250px;
  overflow-y: auto;
  padding: 5px;
}
input {
  width: 70%;
}
</style>
</head>

<body>

<h3>ğŸ”’ Private Chat</h3>

<button onclick="generate()">Generate Private Link</button>
<p id="link"></p>

<div id="chatBox" style="display:none;">
  <div id="chat"></div><br>
  <input id="msg" placeholder="Type message">
  <button onclick="send()">Send</button>
</div>

<script>
const WORKER = "https://private-chat-worker.rk3743169.workers.dev/"; // ğŸ”´ change this

let ws;
let connected = false;

const params = new URLSearchParams(location.search);
const room = params.get("room");

if (room) connect(room);

function generate() {
  const id = Math.random().toString(36).substring(2, 8);
  const url = location.origin + location.pathname + "?room=" + id;
  document.getElementById("link").innerHTML =
    `<a href="${url}">${url}</a>`;
}

function connect(room) {
  document.getElementById("chatBox").style.display = "block";

  ws = new WebSocket(WORKER + "?room=" + room);

  ws.onopen = () => {
    connected = true;
    log("âœ… Connected");
  };

  ws.onmessage = e => {
    log("ğŸ‘¤ Friend: " + e.data);
  };

  ws.onerror = () => {
    log("âŒ Connection error");
  };
}

function send() {
  if (!connected) {
    alert("Not connected yet");
    return;
  }

  const text = msg.value.trim();
  if (!text) return;

  ws.send(text);
  log("ğŸ§‘ You: " + text); // âœ… THIS WAS MISSING
  msg.value = "";
}

function log(t) {
  const chat = document.getElementById("chat");
  chat.innerHTML += t + "<br>";
  chat.scrollTop = chat.scrollHeight;
}
</script>

</body>
</html>
